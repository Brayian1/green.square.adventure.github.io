<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü–∏–∫—Å–µ–ª—å–Ω–∞—è –∏–≥—Ä–∞ - –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∫–≤–∞–¥—Ä–∞—Ç–∞</title>
    <audio id="coinSound" preload="auto">
      <source
        src="https://assets.mixkit.co/sfx/preview/mixkit-game-ball-tap-2073.mp3"
        type="audio/mpeg"
      />
      <source
        src="https://assets.mixkit.co/sfx/preview/mixkit-game-ball-tap-2073.ogg"
        type="audio/ogg"
      />
      –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTML5 –∞—É–¥–∏–æ.
    </audio>
    <audio id="hitSound" preload="auto">
      <source
        src="https://assets.mixkit.co/sfx/preview/mixkit-boxing-punch-2051.mp3"
        type="audio/mpeg"
      />
      <source
        src="https://assets.mixkit.co/sfx/preview/mixkit-boxing-punch-2051.ogg"
        type="audio/ogg"
      />
      –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTML5 –∞—É–¥–∏–æ.
    </audio>
    <audio id="waveSound" preload="auto">
      <source
        src="https://assets.mixkit.co/sfx/preview/mixkit-universal-laser-448.mp3"
        type="audio/mpeg"
      />
      <source
        src="https://assets.mixkit.co/sfx/preview/mixkit-universal-laser-448.ogg"
        type="audio/ogg"
      />
      –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTML5 –∞—É–¥–∏–æ.
    </audio>
    <audio id="magnetSound" preload="auto">
      <source
        src="https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-948.mp3"
        type="audio/mpeg"
      />
      <source
        src="https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-948.ogg"
        type="audio/ogg"
      />
      –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTML5 –∞—É–¥–∏–æ.
    </audio>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        color: #333;
        overflow: hidden;
      }
      .game-container {
        text-align: center;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        max-width: 95vw;
        width: 95vw;
        height: 95vh;
        display: flex;
        flex-direction: column;
      }
      h1 {
        color: #4a5568;
        margin-bottom: 15px;
        font-size: 2.8em;
        font-weight: 700;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .exp-container {
        margin-bottom: 15px;
        padding: 10px 20px;
        background: #f7fafc;
        border-radius: 15px;
        border: 1px solid #e2e8f0;
      }
      .exp-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 1.1em;
        font-weight: 600;
        color: #4a5568;
      }
      .exp-bar-outer {
        width: 100%;
        height: 20px;
        background: #e2e8f0;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      .exp-bar-inner {
        height: 100%;
        background: linear-gradient(90deg, #d69e2e, #f6e05e);
        border-radius: 10px;
        transition: width 0.3s ease;
        position: relative;
      }
      .exp-glow {
        position: absolute;
        top: 0;
        right: 0;
        width: 20px;
        height: 20px;
        background: #fff9c4;
        border-radius: 50%;
        transform: translate(50%, 25%);
        opacity: 0.7;
        animation: pulse 1.5s ease-in-out infinite;
      }
      @keyframes pulse {
        0% {
          transform: translate(50%, 25%) scale(1);
          opacity: 0.7;
        }
        50% {
          transform: translate(50%, 25%) scale(1.2);
          opacity: 1;
        }
        100% {
          transform: translate(50%, 25%) scale(1);
          opacity: 0.7;
        }
      }
      .game-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        font-size: 1.4em;
        font-weight: 600;
        flex-wrap: wrap;
        gap: 10px;
      }
      .score,
      .lives,
      .level,
      .ability {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 12px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 140px;
      }
      .game-board {
        flex: 1;
        background: #1a202c;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        border: none;
        position: relative;
        overflow: hidden;
        margin-bottom: 15px;
        min-height: 400px;
      }
      canvas {
        border-radius: 15px;
        background: #1a202c;
        width: 100%;
        height: 100%;
        display: block;
        max-width: 100%;
        max-height: 100%;
      }
      .controls {
        font-size: 1.3em;
        color: #718096;
        font-weight: 500;
        margin-bottom: 10px;
      }
      .game-over,
      .start-screen,
      .level-complete,
      .difficulty-screen,
      .pause-screen,
      .win-screen,
      .glory-road,
      .shop-screen {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.98);
        padding: 30px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        max-width: 450px;
        width: 90%;
        z-index: 100;
      }
      .game-over h2,
      .start-screen h1,
      .level-complete h2,
      .difficulty-screen h2,
      .pause-screen h2,
      .win-screen h2,
      .glory-road h2,
      .shop-screen h2 {
        margin-bottom: 20px;
        font-size: 2em;
        font-weight: 700;
      }
      .game-over h2 {
        color: #e53e3e;
      }
      .level-complete h2,
      .difficulty-screen h2,
      .pause-screen h2,
      .win-screen h2,
      .glory-road h2,
      .shop-screen h2 {
        color: #4a5568;
      }
      .win-screen h2 {
        color: #38a169;
      }
      .instructions {
        margin: 20px 0;
        padding: 15px;
        background: rgba(74, 85, 104, 0.05);
        border-radius: 15px;
        border: 1px solid rgba(74, 85, 104, 0.1);
      }
      .description-header {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
      }
      .description-icon {
        margin-right: 10px;
        color: #4a5568;
      }
      .description-header h2 {
        margin: 0;
        font-size: 1.6em;
        font-weight: 600;
        color: #4a5568;
      }
      .description-text {
        margin-bottom: 15px;
        line-height: 1.6;
        color: #4a5568;
        font-size: 1em;
        font-weight: 500;
      }
      .features-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .feature-item {
        display: flex;
        align-items: flex-start;
      }
      .feature-icon {
        font-size: 1.2em;
        margin-right: 10px;
        min-width: 24px;
      }
      .feature-item p {
        margin: 0;
        line-height: 1.5;
        color: #4a5568;
        font-size: 0.95em;
      }
      @media (max-width: 480px) {
        .features-grid {
          grid-template-columns: 1fr;
        }
      }
      button {
        border: none;
        padding: 12px 25px;
        font-size: 1.1em;
        border-radius: 12px;
        cursor: pointer;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin: 8px;
      }
      .start-btn,
      .save-difficulty-btn,
      .resume-btn,
      .next-level-btn,
      .shop-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        font-size: 1.2em;
        padding: 15px 30px;
      }
      .restart-btn,
      .quit-btn,
      .quit-to-menu-btn {
        background: linear-gradient(45deg, #e53e3e, #c53030);
        color: white;
      }
      .difficulty-btn,
      .back-to-main-btn,
      .glory-btn,
      .square-btn {
        background: linear-gradient(45deg, #4299e1, #3182ce);
        color: white;
        padding: 10px 20px;
        font-size: 1em;
      }
      .difficulty-btn.active {
        background: linear-gradient(45deg, #667eea, #764ba2);
        box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      }
      button:active {
        transform: translateY(0);
      }
      #finalScore,
      #levelCompleteText,
      #winText {
        font-size: 1.2em;
        margin: 15px 0;
        color: #4a5568;
        font-weight: 500;
      }
      .difficulty-selector {
        margin: 15px 0;
      }
      .difficulty-selector p {
        margin-bottom: 12px;
        font-weight: 600;
        color: #4a5568;
      }
      .game-over,
      .level-complete,
      .difficulty-screen,
      .pause-screen,
      .win-screen,
      .glory-road,
      .shop-screen {
        display: none;
      }
      @media (max-width: 500px) {
        .game-container {
          padding: 15px;
          margin: 10px;
        }
        .game-info {
          flex-direction: column;
          gap: 10px;
        }
        .game-over,
        .start-screen,
        .level-complete,
        .difficulty-screen,
        .pause-screen,
        .win-screen,
        .glory-road,
        .shop-screen {
          padding: 25px 15px;
        }
        h1 {
          font-size: 1.8em;
        }
      }
      .wave-effect {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        transform: translate(-50%, -50%);
        border: 2px solid rgba(124, 58, 237, 0.7);
        background: radial-gradient(
          circle,
          rgba(124, 58, 237, 0.3) 0%,
          rgba(124, 58, 237, 0) 70%
        );
        animation: wavePulse 0.5s ease-out forwards;
      }
      @keyframes wavePulse {
        0% {
          width: 0;
          height: 0;
          opacity: 1;
        }
        100% {
          width: 200px;
          height: 200px;
          opacity: 0;
        }
      }
      .magnet-effect {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        transform: translate(-50%, -50%);
        border: 2px solid rgba(72, 187, 120, 0.7);
        background: radial-gradient(
          circle,
          rgba(72, 187, 120, 0.3) 0%,
          rgba(72, 187, 120, 0) 70%
        );
        animation: magnetPulse 0.3s ease-out forwards;
      }
      @keyframes magnetPulse {
        0% {
          width: 0;
          height: 0;
          opacity: 1;
        }
        100% {
          width: 150px;
          height: 150px;
          opacity: 0;
        }
      }
      .magnet-line {
        position: absolute;
        height: 2px;
        background: rgba(72, 187, 120, 0.7);
        transform-origin: 0 0;
        pointer-events: none;
      }
      .glory-road {
        max-width: 500px;
        width: 90%;
      }
      .glory-road h2 {
        margin-bottom: 25px;
      }
      .episodes {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }
      .episode {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .episode-title {
        font-size: 1.4em;
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 12px;
      }
      .levels {
        display: flex;
        justify-content: center;
        gap: 8px;
      }
      .level-dot {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        color: white;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .level-dot.locked {
        background: #cbd5e0;
        cursor: not-allowed;
      }
      .level-dot.completed {
        background: #38a169;
      }
      .level-dot.current {
        background: #4299e1;
      }
      .level-dot:hover:not(.locked) {
        transform: scale(1.1);
      }
      .shop-screen {
        max-width: 500px;
        width: 90%;
      }
      .shop-screen h2 {
        margin-bottom: 25px;
      }
      .tab-btn {
        background: #e2e8f0;
        color: #4a5568;
        border: none;
        padding: 10px 20px;
        margin: 0 4px;
        font-size: 1em;
        border-radius: 8px 8px 0 0;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
      }
      .tab-btn.active {
        background: #667eea;
        color: white;
      }
      .tab-btn:hover:not(.active) {
        background: #4a5568;
        color: white;
      }
      .shop-items {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 25px;
      }
      .shop-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: #f7fafc;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      .shop-item h3 {
        margin: 0 0 8px 0;
        color: #4a5568;
        font-size: 1.3em;
      }
      .shop-item p {
        margin: 0 0 12px 0;
        color: #718096;
        font-size: 0.95em;
      }
      .shop-item button {
        width: 100%;
        background: linear-gradient(45deg, #48bb78, #38a169);
        color: white;
        padding: 10px;
        font-size: 1em;
      }
      .shop-item button:disabled {
        background: #cbd5e0;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      .shop-item button:hover:disabled {
        transform: none;
      }
      .level-indicator {
        display: flex;
        gap: 4px;
        margin: 4px 0 8px 0;
      }
      .level-dot-small {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #cbd5e0;
      }
      .level-dot-small.active {
        background: #48bb78;
      }
      .purchase-animation {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: #d69e2e;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: bold;
        box-shadow: 0 0 15px rgba(214, 158, 46, 0.6);
        animation: floatUp 1.5s ease-out forwards;
        z-index: 1000;
      }
      @keyframes floatUp {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(-100px) rotate(360deg);
          opacity: 0;
        }
      }
      .notification {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #48bb78;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        font-weight: bold;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .notification.show {
        opacity: 1;
      }
      .reset-screen {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.98);
        padding: 30px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        max-width: 450px;
        width: 90%;
        z-index: 100;
      }
      /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ–∫–∞—á–∫–∏ */
      .upgrade-animation {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 300px;
        height: 300px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: bold;
        font-size: 1.5em;
        z-index: 2000;
        pointer-events: none;
      }
      .upgrade-animation.level-1 {
        background: radial-gradient(circle, #48bb78 0%, #2f855a 70%);
        box-shadow: 0 0 30px rgba(72, 187, 120, 0.8);
        animation: pulse 1s ease-out forwards;
      }
      .upgrade-animation.level-2 {
        background: radial-gradient(circle, #3182ce 0%, #2c5282 70%);
        box-shadow: 0 0 30px rgba(49, 130, 206, 0.8),
          0 0 60px rgba(49, 130, 206, 0.5);
        animation: pulseShine 1.5s ease-out forwards;
      }
      .upgrade-animation.level-3 {
        background: linear-gradient(
          45deg,
          #667eea,
          #764ba2,
          #f093fb,
          #f5576c,
          #4facfe
        );
        background-size: 300% 300%;
        animation: pulseShineRainbow 2s ease-out forwards,
          rainbow 3s linear infinite;
      }
      @keyframes pulse {
        0% {
          transform: translate(-50%, -50%) scale(0);
          opacity: 0;
        }
        70% {
          transform: translate(-50%, -50%) scale(1.2);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }
      @keyframes pulseShine {
        0% {
          transform: translate(-50%, -50%) scale(0);
          opacity: 0;
          box-shadow: 0 0 30px rgba(49, 130, 206, 0.8);
        }
        50% {
          transform: translate(-50%, -50%) scale(1.3);
          opacity: 1;
          box-shadow: 0 0 60px rgba(49, 130, 206, 0.9),
            0 0 80px rgba(49, 130, 206, 0.6);
        }
        70% {
          transform: translate(-50%, -50%) scale(1.1);
          box-shadow: 0 0 50px rgba(49, 130, 206, 0.8),
            0 0 70px rgba(49, 130, 206, 0.5);
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          box-shadow: 0 0 30px rgba(49, 130, 206, 0.8);
        }
      }
      @keyframes pulseShineRainbow {
        0% {
          transform: translate(-50%, -50%) scale(0);
          opacity: 0;
          box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
        }
        40% {
          transform: translate(-50%, -50%) scale(1.4);
          opacity: 1;
          box-shadow: 0 0 60px rgba(102, 126, 234, 0.9),
            0 0 80px rgba(118, 75, 162, 0.6), 0 0 100px rgba(240, 147, 251, 0.7);
        }
        60% {
          transform: translate(-50%, -50%) scale(1.2);
          box-shadow: 0 0 50px rgba(102, 126, 234, 0.8),
            0 0 70px rgba(118, 75, 162, 0.6);
        }
        80% {
          transform: translate(-50%, -50%) scale(1.05);
          box-shadow: 0 0 40px rgba(240, 147, 251, 0.7),
            0 0 60px rgba(245, 87, 108, 0.6);
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
        }
      }
      @keyframes rainbow {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      /* –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω—è 2 */
      .shine-effect {
        position: absolute;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: white;
        opacity: 0.8;
        pointer-events: none;
      }
      /* –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω—è 3 */
      .sparkle {
        position: absolute;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        pointer-events: none;
        opacity: 0;
      }
      .star {
        position: absolute;
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-bottom: 10px solid yellow;
        transform: rotate(35deg);
        opacity: 0;
        pointer-events: none;
      }
      /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ –º–µ–Ω—é */
      .menu-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
      }
      .menu-row {
        display: flex;
        justify-content: center;
        gap: 12px;
      }
      .menu-row .square-btn {
        width: 50px;
        height: 50px;
        min-width: 50px;
        min-height: 50px;
        padding: 0;
        border-radius: 10px;
        font-size: 1.1em;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .menu-row .start-btn {
        min-width: 150px;
        height: 50px;
        border-radius: 10px;
        font-size: 1.1em;
      }
      .menu-row .difficulty-btn {
        min-width: 150px;
        height: 50px;
        border-radius: 10px;
        font-size: 1.1em;
      }
      @media (max-width: 480px) {
        .menu-row .square-btn {
          width: 45px;
          height: 45px;
          min-width: 45px;
          min-height: 45px;
          font-size: 0.9em;
        }
        .menu-row .start-btn,
        .menu-row .difficulty-btn {
          min-width: 130px;
          height: 45px;
          font-size: 1em;
        }
      }
      /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –±–æ–Ω—É—Å–æ–≤ */
      .bonus-tab-btn {
        background: linear-gradient(45deg, #d69e2e, #f6e05e);
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 0 4px;
        font-size: 1em;
        border-radius: 8px 8px 0 0;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
        box-shadow: 0 4px 15px rgba(214, 158, 46, 0.3);
      }
      .bonus-tab-btn:hover:not(.active) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(214, 158, 46, 0.5);
      }
      .bonus-tab-btn.active {
        background: linear-gradient(45deg, #f6e05e, #fefcbf);
        color: #744210;
        box-shadow: 0 0 15px rgba(246, 224, 94, 0.5);
        transform: translateY(-2px);
      }
      .bonus-item {
        background: linear-gradient(135deg, #fefce8, #fffbeb);
        border: 2px solid #f59e0b;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
        text-align: center;
        animation: pulseYellow 2s infinite;
      }
      @keyframes pulseYellow {
        0% {
          box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
        }
        50% {
          box-shadow: 0 4px 25px rgba(245, 158, 11, 0.4);
        }
        100% {
          box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
        }
      }
      .daily-bonus-icon {
        font-size: 2.5em;
        margin-bottom: 10px;
        color: #d69e2e;
        text-shadow: 0 0 10px rgba(214, 158, 46, 0.5);
      }
      .bonus-title {
        font-size: 1.4em;
        font-weight: 700;
        color: #744210;
        margin-bottom: 8px;
      }
      .bonus-desc {
        font-size: 0.95em;
        color: #92400e;
        margin-bottom: 15px;
        line-height: 1.4;
      }
      .bonus-btn {
        background: linear-gradient(45deg, #d69e2e, #f6e05e);
        color: #744210;
        font-weight: 700;
        border: 2px solid #f59e0b;
        box-shadow: 0 4px 15px rgba(214, 158, 46, 0.3);
      }
      .bonus-btn:hover:not(:disabled) {
        background: linear-gradient(45deg, #f6e05e, #fefcbf);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(214, 158, 46, 0.5);
      }
      .bonus-btn:disabled {
        background: #fbbf24;
        color: #744210;
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–Ω–∞—á–∫–∞ —Å–±—Ä–æ—Å–∞ */
      .reset-badge {
        position: absolute;
        top: -10px;
        right: -10px;
        background: #e53e3e;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        font-size: 0.9em;
        box-shadow: 0 0 10px rgba(229, 62, 62, 0.6);
        border: 2px solid white;
      }
      .reset-locked {
        background: #4a5568;
      }
      .reset-tooltip {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #1a202c;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.9em;
        white-space: nowrap;
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
      }
      .reset-tooltip::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: #1a202c;
      }
      .reset-locked:hover .reset-tooltip {
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <!-- –≠–∫—Ä–∞–Ω —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
    <div class="reset-screen" id="resetScreen">
      <h2>–°–ë–†–û–° –ü–†–û–ì–†–ï–°–°–ê</h2>
      <p style="margin: 15px 0; color: #4a5568; font-size: 1.1em">
        –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É —Å –Ω—É–ª—è?
      </p>
      <p style="margin: 15px 0; color: #718096; font-size: 0.9em">
        –ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å: —É—Ä–æ–≤–µ–Ω—å, –º–æ–Ω–µ—Ç—ã, —É–ª—É—á—à–µ–Ω–∏—è –∏ –∏—Å—Ç–æ—Ä–∏—è
        –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è.
      </p>
      <p style="margin: 15px 0; color: #718096; font-size: 0.9em">
        <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –°–±—Ä–æ—Å –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–µ 10 —É—Ä–æ–≤–Ω–µ–π —Ä–∞–Ω–≥–∞.
      </p>
      <button class="restart-btn" onclick="confirmReset()">
        –î–ê, –°–ë–†–û–°–ò–¢–¨ –í–°–Å
      </button>
      <button class="back-to-main-btn" onclick="cancelReset()">
        –ù–ï–¢, –û–°–¢–ê–í–ò–¢–¨ –ü–†–û–ì–†–ï–°–°
      </button>
    </div>
    <div class="start-screen" id="startScreen">
      <h1>–ü–†–ò–ö–õ–Æ–ß–ï–ù–ò–Ø –ö–í–ê–î–†–ê–¢–ê</h1>
      <div class="exp-container">
        <div class="exp-info">
          <span>–†–∞–Ω–≥: <span id="rankLevelStart">1</span></span>
          <span
            ><span id="currentExpStart">0</span>/<span id="requiredExpStart"
              >100</span
            >
            EXP</span
          >
        </div>
        <div class="exp-bar-outer">
          <div class="exp-bar-inner" id="expBarStart">
            <div class="exp-glow"></div>
          </div>
        </div>
      </div>
      <div class="instructions">
        <div class="description-header">
          <svg
            class="description-icon"
            width="30"
            height="30"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
              stroke="#4A5568"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M12 16V12"
              stroke="#4A5568"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M12 8H12.01"
              stroke="#4A5568"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <h2>–û –∫–≤–∞–¥—Ä–∞—Ç–µ</h2>
        </div>
        <p class="description-text">
          –ö–≤–∞–¥—Ä–∞—Ç –æ—á–µ–Ω—å –Ω–µ –ª—é–±–∏—Ç –∑–ª—ã—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤, –ø–æ–º–æ–≥–∏—Ç–µ –µ–º—É —Å–ø–∞—Å—Ç–∏—Å—å –ø—Ä–æ–π–¥—è
          —É—Ä–æ–≤–Ω–∏!
        </p>
        <div class="features-grid">
          <div class="feature-item">
            <div class="feature-icon">üéÆ</div>
            <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∑–µ–ª–µ–Ω—ã–º –∫–≤–∞–¥—Ä–∞—Ç–æ–º –∫–ª–∞–≤–∏—à–∞–º–∏ WASD</p>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üü°</div>
            <p>–°–æ–±–∏—Ä–∞–π—Ç–µ –∂–µ–ª—Ç—ã–µ –º–æ–Ω–µ—Ç—ã</p>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üî¥</div>
            <p>–ò–∑–±–µ–≥–∞–π—Ç–µ –∫—Ä–∞—Å–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤</p>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üîµ</div>
            <p>–û—Å—Ç–µ—Ä–µ–≥–∞–π—Ç–µ—Å—å —Å–∏–Ω–∏—Ö —Å—Ç—Ä–µ–ª–∫–æ–≤ —Å 7 —É—Ä–æ–≤–Ω—è!</p>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üí•</div>
            <p>SPACE - –≤–æ–ª–Ω–∞ —Ä–∞–∑ –≤ 3 —Å–µ–∫—É–Ω–¥—ã</p>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üß≤</div>
            <p>SHIFT - –º–∞–≥–Ω–∏—Ç —Ä–∞–∑ –≤ 5 —Å–µ–∫—É–Ω–¥</p>
          </div>
        </div>
      </div>
      <div
        class="total-coins"
        style="
          font-size: 1.3em;
          font-weight: 600;
          color: #d69e2e;
          margin: 15px 0;
        "
      >
        –í—Å–µ–≥–æ –º–æ–Ω–µ—Ç: <span id="totalCoins">0</span>
      </div>
      <div class="menu-buttons">
        <div class="menu-row">
          <button class="square-btn glory-btn" onclick="showGloryRoad()">
            üèÜ
          </button>
          <button class="start-btn" onclick="startGame()">–ù–ê–ß–ê–¢–¨</button>
          <button class="square-btn shop-btn" onclick="showShop()">üõí</button>
        </div>
        <div class="menu-row">
          <button class="square-btn" onclick="showResetScreen()">
            <div class="reset-locked" id="resetButton">
              üîÑ
              <div class="reset-badge" id="resetBadge">0</div>
              <div class="reset-tooltip" id="resetTooltip">
                –°–±—Ä–æ—Å –≤–æ–∑–º–æ–∂–µ–Ω –Ω–∞ 10, 20, 30... —Ä–∞–Ω–≥–∞—Ö
              </div>
            </div>
          </button>
          <button class="difficulty-btn" onclick="showDifficultyScreen()">
            –ù–ê–°–¢–†–û–ô–ö–ò
          </button>
          <button
            class="square-btn"
            disabled
            style="visibility: hidden"
          ></button>
        </div>
      </div>
    </div>
    <!-- === –≠–ö–†–ê–ù –ò–°–¢–û–†–ò–ò === -->
    <div class="glory-road" id="gloryRoad">
      <h2>–ò–°–¢–û–†–ò–Ø</h2>
      <div class="episodes">
        <div class="episode">
          <div class="episode-title">–≠–ø–∏–∑–æ–¥ 1: –ù–∞—á–∞–ª–æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π</div>
          <div class="levels" id="episode1Levels"></div>
        </div>
        <div class="episode">
          <div class="episode-title">–≠–ø–∏–∑–æ–¥ 2: –¢—ë–º–Ω—ã–µ –≥–ª—É–±–∏–Ω—ã</div>
          <div class="levels" id="episode2Levels"></div>
        </div>
      </div>
      <button
        class="back-to-main-btn"
        style="margin-top: 25px"
        onclick="showStartScreen()"
      >
        –ù–ê–ó–ê–î
      </button>
    </div>
    <!-- === –≠–ö–†–ê–ù –ú–ê–ì–ê–ó–ò–ù–ê === -->
    <div class="shop-screen" id="shopScreen">
      <h2>–ú–ê–ì–ê–ó–ò–ù</h2>
      <div style="display: flex; justify-content: center; margin-bottom: 15px">
        <button
          id="tab-abilities"
          class="tab-btn active"
          onclick="switchTab('abilities')"
        >
          –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        </button>
        <button id="tab-power" class="tab-btn" onclick="switchTab('power')">
          –°–∏–ª–∞
        </button>
        <button
          id="tab-bonuses"
          class="bonus-tab-btn"
          onclick="switchTab('bonuses')"
        >
          –ë–æ–Ω—É—Å—ã
        </button>
      </div>
      <div class="shop-items" id="shopItems">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è -->
      </div>
      <button class="back-to-main-btn" onclick="showStartScreen()">
        –ù–ê–ó–ê–î
      </button>
    </div>
    <!-- === –û–°–¢–ê–õ–¨–ù–´–ï –≠–ö–†–ê–ù–´ === -->
    <div class="difficulty-screen" id="difficultyScreen">
      <h2>–í–´–ë–û–† –°–õ–û–ñ–ù–û–°–¢–ò</h2>
      <div class="difficulty-selector">
        <p>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</p>
        <button
          class="difficulty-btn active"
          id="easyBtn"
          onclick="setDifficulty('easy')"
        >
          –õ–ï–ì–ö–ê–Ø
        </button>
        <button
          class="difficulty-btn"
          id="hardBtn"
          onclick="setDifficulty('hard')"
        >
          –°–õ–û–ñ–ù–ê–Ø
        </button>
      </div>
      <button class="save-difficulty-btn" onclick="saveAndReturnToMain()">
        –°–û–•–†–ê–ù–ò–¢–¨ –ò –í–´–ô–¢–ò
      </button>
      <button class="back-to-main-btn" onclick="showStartScreen()">
        –ù–ê–ó–ê–î
      </button>
    </div>
    <div class="pause-screen" id="pauseScreen">
      <h2>–ü–ê–£–ó–ê</h2>
      <p>–ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p>
      <button class="resume-btn" onclick="resumeGame()">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
      <button class="quit-btn" onclick="quitToMainMenu()">–í–´–ô–¢–ò –í –ú–ï–ù–Æ</button>
    </div>
    <div class="level-complete" id="levelComplete">
      <h2>–£–†–û–í–ï–ù–¨ –ü–†–û–ô–î–ï–ù!</h2>
      <p id="levelCompleteText">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–≤–Ω—é.</p>
      <button class="next-level-btn" onclick="nextLevel()">
        –°–õ–ï–î–£–Æ–©–ò–ô –£–†–û–í–ï–ù–¨
      </button>
      <button class="quit-to-menu-btn" onclick="quitToMainMenuFromScreen()">
        –í–´–ô–¢–ò –í –ú–ï–ù–Æ
      </button>
    </div>
    <div class="win-screen" id="winScreen">
      <h2>–ü–û–ë–ï–î–ê!</h2>
      <p id="winText">–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ 10 —É—Ä–æ–≤–Ω–µ–π!</p>
      <button class="restart-btn" onclick="restartGame()">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
      <button class="quit-to-menu-btn" onclick="quitToMainMenuFromScreen()">
        –í–´–ô–¢–ò –í –ú–ï–ù–Æ
      </button>
    </div>
    <div class="game-over" id="gameOver">
      <h2>–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2>
      <p id="finalScore">–°—á–µ—Ç: 0</p>
      <button class="restart-btn" onclick="restartGame()">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
      <button class="quit-to-menu-btn" onclick="quitToMainMenuFromScreen()">
        –í–´–ô–¢–ò –í –ú–ï–ù–Æ
      </button>
    </div>
    <div class="game-container" id="gameContainer" style="display: none">
      <h1>–ü–†–ò–ö–õ–Æ–ß–ï–ù–ò–Ø –ö–í–ê–î–†–ê–¢–ê</h1>
      <div class="exp-container">
        <div class="exp-info">
          <span>–†–∞–Ω–≥: <span id="rankLevel">1</span></span>
          <span
            ><span id="currentExp">0</span>/<span id="requiredExp">100</span>
            EXP</span
          >
        </div>
        <div class="exp-bar-outer">
          <div class="exp-bar-inner" id="expBar">
            <div class="exp-glow"></div>
          </div>
        </div>
      </div>
      <div class="game-info">
        <div class="score">–°—á–µ—Ç: <span id="score">0</span></div>
        <div class="level">–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
        <div class="lives">–ñ–∏–∑–Ω–∏: <span id="lives">10</span></div>
        <div class="ability">
          <div>–í–æ–ª–Ω–∞: <span id="waveCooldown">–ì–æ—Ç–æ–≤–∞</span></div>
          <div>–ú–∞–≥–Ω–∏—Ç: <span id="magnetCooldown">–ì–æ—Ç–æ–≤</span></div>
        </div>
      </div>
      <div class="game-board">
        <canvas id="gameCanvas"></canvas>
      </div>
      <div class="controls">
        <p>WASD - –¥–≤–∏–∂–µ–Ω–∏–µ. SPACE - –≤–æ–ª–Ω–∞. SHIFT - –º–∞–≥–Ω–∏—Ç. ESC - –ø–∞—É–∑–∞</p>
      </div>
    </div>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∞–Ω–∏–º–∞—Ü–∏–∏ -->
    <div id="notification" class="notification"></div>
    <script>
      // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è hex –≤ rgb
      function hexToRgb(hex) {
        const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
        hex = hex.replace(
          shorthandRegex,
          (m, r, g, b) => r + r + g + g + b + b
        );
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result
          ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(
              result[3],
              16
            )}`
          : "255, 0, 0";
      }
      // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      let canvas, ctx;
      let player = { x: 400, y: 500, size: 30, speed: 3, color: "#48bb78" };
      let coins = [];
      let enemies = [];
      let bullets = [];
      let score = 0;
      let lives = 10;
      let maxLives = 10;
      let currentLevel = 1;
      let gameRunning = false;
      let gamePaused = false;
      let keys = {};
      let gameLoop;
      let difficulty = "easy";
      const coinAudio = document.getElementById("coinSound");
      const hitAudio = document.getElementById("hitSound");
      const waveAudio = document.getElementById("waveSound");
      const magnetAudio = document.getElementById("magnetSound");
      let lastWaveTime = 0;
      let baseWaveCooldown = 3000;
      let waveCooldown = baseWaveCooldown;
      const waveRadius = 100;
      let lastMagnetTime = 0;
      let baseMagnetCooldown = 5000;
      let magnetCooldown = baseMagnetCooldown;
      const magnetRadius = 150;
      const magnetStrength = 0.15;
      let isMagnetActive = false;
      let trail = [];
      const maxTrailLength = 20;
      let magnetLines = [];
      const levelSettings = {
        easy: {
          1: {
            coins: 15,
            enemies: 5,
            winScore: 30,
            enemySpeed: 0.8,
            bigEnemies: 0,
            bigEnemyChance: 0,
            shooters: 0,
          },
          2: {
            coins: 20,
            enemies: 7,
            winScore: 50,
            enemySpeed: 1.0,
            bigEnemies: 0,
            bigEnemyChance: 0,
            shooters: 0,
          },
          3: {
            coins: 25,
            enemies: 9,
            winScore: 75,
            enemySpeed: 1.2,
            bigEnemies: 1,
            bigEnemyChance: 0.2,
            shooters: 0,
          },
          4: {
            coins: 30,
            enemies: 11,
            winScore: 105,
            enemySpeed: 1.4,
            bigEnemies: 2,
            bigEnemyChance: 0.4,
            shooters: 0,
          },
          5: {
            coins: 35,
            enemies: 13,
            winScore: 150,
            enemySpeed: 1.6,
            bigEnemies: 3,
            bigEnemyChance: 0.6,
            shooters: 0,
          },
          6: {
            coins: 40,
            enemies: 14,
            winScore: 180,
            enemySpeed: 1.7,
            bigEnemies: 3,
            bigEnemyChance: 0.7,
            shooters: 0,
          },
          7: {
            coins: 45,
            enemies: 15,
            winScore: 220,
            enemySpeed: 1.8,
            bigEnemies: 4,
            bigEnemyChance: 0.7,
            shooters: 1,
          },
          8: {
            coins: 50,
            enemies: 16,
            winScore: 270,
            enemySpeed: 1.9,
            bigEnemies: 5,
            bigEnemyChance: 0.8,
            shooters: 2,
          },
          9: {
            coins: 55,
            enemies: 18,
            winScore: 330,
            enemySpeed: 2.0,
            bigEnemies: 5,
            bigEnemyChance: 0.8,
            shooters: 2,
          },
          10: {
            coins: 60,
            enemies: 20,
            winScore: 400,
            enemySpeed: 2.2,
            bigEnemies: 6,
            bigEnemyChance: 0.9,
            shooters: 3,
          },
        },
        hard: {
          1: {
            coins: 15,
            enemies: 5,
            winScore: 60,
            enemySpeed: 1.0,
            bigEnemies: 0,
            bigEnemyChance: 0,
            shooters: 0,
          },
          2: {
            coins: 20,
            enemies: 7,
            winScore: 100,
            enemySpeed: 1.2,
            bigEnemies: 0,
            bigEnemyChance: 0,
            shooters: 0,
          },
          3: {
            coins: 25,
            enemies: 9,
            winScore: 150,
            enemySpeed: 1.4,
            bigEnemies: 1,
            bigEnemyChance: 0.2,
            shooters: 0,
          },
          4: {
            coins: 30,
            enemies: 11,
            winScore: 210,
            enemySpeed: 1.6,
            bigEnemies: 2,
            bigEnemyChance: 0.4,
            shooters: 0,
          },
          5: {
            coins: 35,
            enemies: 13,
            winScore: 300,
            enemySpeed: 1.8,
            bigEnemies: 3,
            bigEnemyChance: 0.6,
            shooters: 0,
          },
          6: {
            coins: 40,
            enemies: 14,
            winScore: 450,
            enemySpeed: 1.9,
            bigEnemies: 3,
            bigEnemyChance: 0.7,
            shooters: 0,
          },
          7: {
            coins: 45,
            enemies: 16,
            winScore: 550,
            enemySpeed: 2.0,
            bigEnemies: 4,
            bigEnemyChance: 0.7,
            shooters: 1,
          },
          8: {
            coins: 50,
            enemies: 18,
            winScore: 660,
            enemySpeed: 2.1,
            bigEnemies: 5,
            bigEnemyChance: 0.8,
            shooters: 2,
          },
          9: {
            coins: 55,
            enemies: 20,
            winScore: 780,
            enemySpeed: 2.2,
            bigEnemies: 5,
            bigEnemyChance: 0.8,
            shooters: 2,
          },
          10: {
            coins: 60,
            enemies: 22,
            winScore: 900,
            enemySpeed: 2.4,
            bigEnemies: 6,
            bigEnemyChance: 0.9,
            shooters: 3,
          },
        },
      };
      const MIN_SPAWN_DISTANCE = 150;
      // –ü—Ä–æ–≥—Ä–µ—Å—Å
      let totalCoins = 0;
      let unlockedLevels = 1;
      let completedLevels = [];
      let unlockedEpisodes = 1;
      let lastAttemptedLevel = 1;
      // –£–ª—É—á—à–µ–Ω–∏—è (—Ç–µ–ø–µ—Ä—å —Å —É—Ä–æ–≤–Ω—è–º–∏)
      let upgrades = {
        wave: 0,
        magnet: 0,
        health: 0,
        speed: 0,
      };
      // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π —Å —Ç—Ä–µ–º—è —É—Ä–æ–≤–Ω—è–º–∏
      const upgradeConfig = {
        wave: {
          maxLevel: 3,
          baseCooldown: 3000,
          cooldownReduction: [1000, 700, 500], // –°–Ω–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏ –Ω–∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å
          costs: [800, 1500, 2500],
          effects: [
            "–°–æ–∫—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫—É —Å 3 –¥–æ 2 —Å–µ–∫—É–Ω–¥",
            "–°–æ–∫—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫—É –¥–æ 1.3 —Å–µ–∫—É–Ω–¥",
            "–°–æ–∫—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫—É –¥–æ 0.8 —Å–µ–∫—É–Ω–¥",
          ],
        },
        magnet: {
          maxLevel: 3,
          baseCooldown: 5000,
          cooldownReduction: [2000, 1500, 1000],
          costs: [1000, 1800, 3000],
          effects: [
            "–°–æ–∫—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫—É —Å 5 –¥–æ 3 —Å–µ–∫—É–Ω–¥",
            "–°–æ–∫—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫—É –¥–æ 1.5 —Å–µ–∫—É–Ω–¥",
            "–°–æ–∫—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫—É –¥–æ 0.5 —Å–µ–∫—É–Ω–¥",
          ],
        },
        health: {
          maxLevel: 3,
          baseHealth: 10,
          healthIncrease: [2, 2, 2],
          costs: [2000, 3500, 5000],
          effects: [
            "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å. –∂–∏–∑–Ω–∏ —Å 10 –¥–æ 12",
            "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å. –∂–∏–∑–Ω–∏ –¥–æ 14",
            "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å. –∂–∏–∑–Ω–∏ –¥–æ 16",
          ],
        },
        speed: {
          maxLevel: 3,
          baseSpeed: 3,
          speedIncrease: [0.5, 0.4, 0.3],
          costs: [2200, 3800, 5500],
          effects: [
            "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è –Ω–∞ 0.5",
            "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ 0.9 –≤—Å–µ–≥–æ",
            "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ 1.2 –≤—Å–µ–≥–æ",
          ],
        },
      };
      // –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤
      let rankLevel = 1;
      let currentExp = 0;
      let requiredExp = 100;
      // –°–∏—Å—Ç–µ–º–∞ —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
      let resetCount = 0;
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –æ–ø—ã—Ç–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
      function calculateRequiredExp(level) {
        // –§–æ—Ä–º—É–ª–∞: 100, 250, 450, 700, 1000, 1350, 1750, 2200, 2700, 3250...
        // –†–æ—Å—Ç: +150, +200, +250, +300, +350, +400, +450, +500...
        // –≠—Ç–æ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 25 * n¬≤ + 75 * n
        return 25 * level * level + 75 * level;
      }
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ –æ–ø—ã—Ç–∞
      function updateExpBar() {
        const expPercentage = (currentExp / requiredExp) * 100;
        document.getElementById("expBar").style.width = expPercentage + "%";
        document.getElementById("rankLevel").textContent = rankLevel;
        document.getElementById("currentExp").textContent = currentExp;
        document.getElementById("requiredExp").textContent = requiredExp;
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –æ–ø—ã—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
        if (document.getElementById("expBarStart")) {
          document.getElementById("expBarStart").style.width =
            expPercentage + "%";
          document.getElementById("rankLevelStart").textContent = rankLevel;
          document.getElementById("currentExpStart").textContent = currentExp;
          document.getElementById("requiredExpStart").textContent = requiredExp;
        }
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–±—Ä–æ—Å–∞
        updateResetButton();
      }
      // –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–Ω–æ –ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
      function canResetProgress() {
        return rankLevel % 10 === 0 && rankLevel > 0;
      }
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞
      function updateResetButton() {
        const resetButton = document.getElementById("resetButton");
        const resetBadge = document.getElementById("resetBadge");
        const resetTooltip = document.getElementById("resetTooltip");
        
        if (canResetProgress()) {
          resetButton.classList.remove("reset-locked");
          resetButton.style.cursor = "pointer";
          resetTooltip.style.display = "none";
        } else {
          resetButton.classList.add("reset-locked");
          resetButton.style.cursor = "not-allowed";
          resetTooltip.style.display = "block";
        }
        
        resetBadge.textContent = resetCount;
      }
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—ã—Ç–∞
      function addExp(amount) {
        currentExp += amount;
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
        while (currentExp >= requiredExp) {
          currentExp -= requiredExp;
          rankLevel++;
          requiredExp = calculateRequiredExp(rankLevel);
          // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
          showNotification(`üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ ${rankLevel} —Ä–∞–Ω–≥–∞!`);
          // –°–ª—É—á–∞–π–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–Ω–≥–∞
          if (rankLevel % 5 === 0) {
            showNotification(
              `üéÅ –ë–æ–Ω—É—Å! –ü–æ–ª—É—á–µ–Ω–æ 50 –º–æ–Ω–µ—Ç –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ ${rankLevel} —Ä–∞–Ω–≥–∞!`
            );
            totalCoins += 50;
            document.getElementById("totalCoins").textContent = totalCoins;
          }
          // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞ –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–Ω–≥–∞
          updateResetButton();
        }
        updateExpBar();
      }
      // === –¢–û–í–ê–†–´ –ú–ê–ì–ê–ó–ò–ù–ê ===
      const shopItems = {
        abilities: [
          {
            id: "buyWaveBtn",
            title: "–£–ª—É—á—à–µ–Ω–∏–µ –≤–æ–ª–Ω—ã",
            desc: "–°–æ–∫—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏ –≤–æ–ª–Ω—ã",
            type: "wave",
          },
          {
            id: "buyMagnetBtn",
            title: "–£–ª—É—á—à–µ–Ω–∏–µ –º–∞–≥–Ω–∏—Ç–∞",
            desc: "–°–æ–∫—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏ –º–∞–≥–Ω–∏—Ç–∞",
            type: "magnet",
          },
        ],
        power: [
          {
            id: "buyHealthBtn",
            title: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ",
            desc: "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–µ–π",
            type: "health",
          },
          {
            id: "buySpeedBtn",
            title: "–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏",
            desc: "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è",
            type: "speed",
          },
        ],
        bonuses: [
          {
            id: "dailyBonusBtn",
            title: "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å",
            desc: "–ü–æ–ª—É—á–∞–π—Ç–µ 100 –º–æ–Ω–µ—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å",
            type: "bonus",
          },
        ],
      };
      // === –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö ===
      function switchTab(tab) {
        document
          .getElementById("tab-abilities")
          .classList.toggle("active", tab === "abilities");
        document
          .getElementById("tab-power")
          .classList.toggle("active", tab === "power");
        document
          .getElementById("tab-bonuses")
          .classList.toggle("active", tab === "bonuses");
        renderShopItems(tab);
      }
      // === –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –¢–û–í–ê–†–û–í ===
      function renderShopItems(tab) {
        const container = document.getElementById("shopItems");
        container.innerHTML = "";
        shopItems[tab].forEach((item) => {
          const shopItem = document.createElement("div");
          if (tab === "bonuses") {
            shopItem.className = "shop-item bonus-item";
          } else {
            shopItem.className = "shop-item";
          }
          
          if (tab === "bonuses") {
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è –±–æ–Ω—É—Å–æ–≤
            const now = Date.now();
            const lastBonusTime = localStorage.getItem("lastDailyBonusTime");
            let buttonText, isDisabled = false;
            
            if (lastBonusTime && now - parseInt(lastBonusTime) < 86400000) {
              const hoursLeft = Math.ceil((86400000 - (now - parseInt(lastBonusTime))) / 3600000);
              buttonText = `–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ${hoursLeft}—á`;
              isDisabled = true;
            } else {
              buttonText = "–ü–æ–ª—É—á–∏—Ç—å 100 –º–æ–Ω–µ—Ç";
              isDisabled = false;
            }
            
            shopItem.innerHTML = `
              <div class="daily-bonus-icon">üéÅ</div>
              <h3 class="bonus-title">${item.title}</h3>
              <p class="bonus-desc">${item.desc}</p>
              <p class="bonus-desc">–ü–æ–ª—É—á–∞–π—Ç–µ 100 –º–æ–Ω–µ—Ç –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞</p>
              <button id="${item.id}" class="bonus-btn" onclick="claimDailyBonus()" ${
                isDisabled ? "disabled" : ""
              }>
                ${buttonText}
              </button>
            `;
          } else {
            // –û–±—ã—á–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            const currentLevel = upgrades[item.type];
            const config = upgradeConfig[item.type];
            const isMaxLevel = currentLevel >= config.maxLevel;
            const canAfford = totalCoins >= config.costs[currentLevel];
            // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π
            let levelIndicator = '<div class="level-indicator">';
            for (let i = 0; i < config.maxLevel; i++) {
              levelIndicator += `<div class="level-dot-small ${
                i < currentLevel ? "active" : ""
              }"></div>`;
            }
            levelIndicator += "</div>";
            // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            let buttonText;
            if (isMaxLevel) {
              buttonText = "–ú–∞–∫—Å. —É—Ä–æ–≤–µ–Ω—å";
            } else if (canAfford) {
              buttonText = `–£–ª—É—á—à–∏—Ç—å –∑–∞ ${config.costs[currentLevel]} –º–æ–Ω–µ—Ç`;
            } else {
              buttonText = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (${totalCoins}/${config.costs[currentLevel]})`;
            }
            // –û–ø–∏—Å–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞
            const effectText = isMaxLevel
              ? `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: ${config.effects[config.maxLevel - 1]}`
              : config.effects[currentLevel];
            shopItem.innerHTML = `
              <h3>${item.title}</h3>
              <p>${item.desc}</p>
              ${levelIndicator}
              <p style="color: #48bb78; font-weight: 600;">–£—Ä–æ–≤–µ–Ω—å ${currentLevel}/${
                config.maxLevel
              }</p>
              <p>${effectText}</p>
              <button id="${item.id}" onclick="buyUpgrade('${item.type}')" ${
                isMaxLevel || !canAfford ? "disabled" : ""
              }>
                ${buttonText}
              </button>
            `;
          }
          container.appendChild(shopItem);
        });
      }
      // === –û–ë–©–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–û–ö–£–ü–ö–ò –£–õ–£–ß–®–ï–ù–ò–Ø ===
      function buyUpgrade(type) {
        const config = upgradeConfig[type];
        const currentLevel = upgrades[type];
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
        if (currentLevel >= config.maxLevel) return;
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –º–æ–Ω–µ—Ç
        if (totalCoins < config.costs[currentLevel]) return;
        // –í—ã—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
        totalCoins -= config.costs[currentLevel];
        upgrades[type] = currentLevel + 1;
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —É–ª—É—á—à–µ–Ω–∏—è
        applyUpgradeEffect(type);
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
        saveProgress();
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        document.getElementById("totalCoins").textContent = totalCoins;
        showPurchaseAnimation(config.costs[currentLevel]);
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–æ–∫–∞—á–∫–∏
        showUpgradeAnimation(type, upgrades[type]);
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const upgradeNames = {
          wave: "–≤–æ–ª–Ω—ã",
          magnet: "–º–∞–≥–Ω–∏—Ç–∞",
          health: "–∑–¥–æ—Ä–æ–≤—å—è",
          speed: "—Å–∫–æ—Ä–æ—Å—Ç–∏",
        };
        showNotification(
          `‚ö° –£—Ä–æ–≤–µ–Ω—å ${upgrades[type]} —É–ª—É—á—à–µ–Ω–∏—è ${upgradeNames[type]} –∫—É–ø–ª–µ–Ω!`
        );
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω
        renderShopItems(
          document.getElementById("tab-abilities").classList.contains("active")
            ? "abilities"
            : "power"
        );
      }
      
      // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞
      function claimDailyBonus() {
        const now = Date.now();
        const lastBonusTime = localStorage.getItem("lastDailyBonusTime");
        const dailyBonusBtn = document.getElementById("dailyBonusBtn");
        if (lastBonusTime && now - parseInt(lastBonusTime) < 86400000) {
          const hoursLeft = Math.ceil(
            (86400000 - (now - parseInt(lastBonusTime))) / 3600000
          );
          dailyBonusBtn.textContent = "–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ " + hoursLeft + "—á";
          dailyBonusBtn.disabled = true;
          setTimeout(updateDailyBonusButton, 60000);
          showNotification("–ë–æ–Ω—É—Å –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑ –≤ 24 —á–∞—Å–∞!");
          return;
        }
        totalCoins += 100;
        localStorage.setItem("totalCoins", totalCoins);
        localStorage.setItem("lastDailyBonusTime", now);
        document.getElementById("totalCoins").textContent = totalCoins;
        dailyBonusBtn.textContent = "–ë–æ–Ω—É—Å –ø–æ–ª—É—á–µ–Ω!";
        dailyBonusBtn.disabled = true;
        setTimeout(updateDailyBonusButton, 60000);
        showNotification("üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏ 100 –º–æ–Ω–µ—Ç! –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∑–∞–≤—Ç—Ä–∞!");
        showPurchaseAnimation(100);
      }
      
      function updateDailyBonusButton() {
        const now = Date.now();
        const lastBonusTime = localStorage.getItem("lastDailyBonusTime");
        const dailyBonusBtn = document.getElementById("dailyBonusBtn");
        if (!dailyBonusBtn) return;
        if (lastBonusTime && now - parseInt(lastBonusTime) < 86400000) {
          const hoursLeft = Math.ceil(
            (86400000 - (now - parseInt(lastBonusTime))) / 3600000
          );
          dailyBonusBtn.textContent = "–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ " + hoursLeft + "—á";
          dailyBonusBtn.disabled = true;
          setTimeout(updateDailyBonusButton, 60000);
        } else {
          dailyBonusBtn.textContent = "–ü–æ–ª—É—á–∏—Ç—å 100 –º–æ–Ω–µ—Ç";
          dailyBonusBtn.disabled = false;
        }
      }
      // === –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –≠–§–§–ï–ö–¢–û–í –£–õ–£–ß–®–ï–ù–ò–ô ===
      function applyUpgradeEffect(type) {
        const config = upgradeConfig[type];
        const level = upgrades[type];
        switch (type) {
          case "wave":
            waveCooldown =
              config.baseCooldown -
              config.cooldownReduction
                .slice(0, level)
                .reduce((a, b) => a + b, 0);
            break;
          case "magnet":
            magnetCooldown =
              config.baseCooldown -
              config.cooldownReduction
                .slice(0, level)
                .reduce((a, b) => a + b, 0);
            break;
          case "health":
            maxLives =
              config.baseHealth +
              config.healthIncrease.slice(0, level).reduce((a, b) => a + b, 0);
            lives = Math.min(lives, maxLives); // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∂–∏–∑–Ω–∏ –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—Ç –º–∞–∫—Å–∏–º—É–º
            if (gameRunning) {
              document.getElementById("lives").textContent = lives;
            }
            break;
          case "speed":
            player.speed =
              config.baseSpeed +
              config.speedIncrease.slice(0, level).reduce((a, b) => a + b, 0);
            break;
        }
      }
      // === –ê–ù–ò–ú–ê–¶–ò–ò –ü–†–û–ö–ê–ß–ö–ò ===
      function showUpgradeAnimation(type, level) {
        const upgradeNames = {
          wave: "–≤–æ–ª–Ω—ã",
          magnet: "–º–∞–≥–Ω–∏—Ç–∞",
          health: "–∑–¥–æ—Ä–æ–≤—å—è",
          speed: "—Å–∫–æ—Ä–æ—Å—Ç–∏",
        };
        const animation = document.createElement("div");
        animation.className = `upgrade-animation level-${level}`;
        animation.textContent = `–£—Ä–æ–≤–µ–Ω—å ${level}`;
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤ –¥–æ–∫—É–º–µ–Ω—Ç
        document.body.appendChild(animation);
        // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è
        if (level === 2) {
          createShineEffects();
        } else if (level === 3) {
          createRainbowEffects();
        }
        // –£–¥–∞–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
          if (animation.parentNode) {
            animation.parentNode.removeChild(animation);
          }
        }, 2500);
      }
      function createShineEffects() {
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤–µ—Ç—è—â–∏—Ö—Å—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        for (let i = 0; i < 8; i++) {
          const shine = document.createElement("div");
          shine.className = "shine-effect";
          // –°–ª—É—á–∞–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤–æ–∫—Ä—É–≥ —Ü–µ–Ω—Ç—Ä–∞
          const angle = ((i * 45 + Math.random() * 30) * Math.PI) / 180;
          const distance = 100 + Math.random() * 50;
          const x = centerX + Math.cos(angle) * distance;
          const y = centerY + Math.sin(angle) * distance;
          shine.style.left = `${x}px`;
          shine.style.top = `${y}px`;
          // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
          shine.style.animation = `shinePulse 1s ease-out ${i * 0.1}s forwards`;
          document.body.appendChild(shine);
          // –£–¥–∞–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã
          setTimeout(() => {
            if (shine.parentNode) {
              shine.parentNode.removeChild(shine);
            }
          }, 1500);
        }
      }
      function createRainbowEffects() {
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        // –°–æ–∑–¥–∞–µ–º —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–µ –∏—Å–∫—Ä—ã
        for (let i = 0; i < 15; i++) {
          const sparkle = document.createElement("div");
          sparkle.className = "sparkle";
          // –°–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç —Ä–∞–¥—É–≥–∏
          const colors = [
            "#ff0000",
            "#ff7f00",
            "#ffff00",
            "#00ff00",
            "#0000ff",
            "#4b0082",
            "#9400d3",
          ];
          sparkle.style.backgroundColor = colors[i % colors.length];
          // –°–ª—É—á–∞–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
          const angle = (Math.random() * 360 * Math.PI) / 180;
          const distance = 50 + Math.random() * 100;
          const x = centerX + Math.cos(angle) * distance;
          const y = centerY + Math.sin(angle) * distance;
          sparkle.style.left = `${x}px`;
          sparkle.style.top = `${y}px`;
          // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –¥–≤–∏–∂–µ–Ω–∏—è
          sparkle.style.animation = `sparklePulse 1.5s ease-out ${
            Math.random() * 0.5
          }s forwards`;
          document.body.appendChild(sparkle);
          // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
          setTimeout(() => {
            if (sparkle.parentNode) {
              sparkle.parentNode.removeChild(sparkle);
            }
          }, 2000);
        }
        // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏
        for (let i = 0; i < 8; i++) {
          const star = document.createElement("div");
          star.className = "star";
          const angle = (Math.random() * 360 * Math.PI) / 180;
          const distance = 70 + Math.random() * 80;
          const x = centerX + Math.cos(angle) * distance;
          const y = centerY + Math.sin(angle) * distance;
          star.style.left = `${x}px`;
          star.style.top = `${y}px`;
          star.style.animation = `starPulse 2s ease-out ${
            Math.random() * 0.8
          }s forwards`;
          document.body.appendChild(star);
          setTimeout(() => {
            if (star.parentNode) {
              star.parentNode.removeChild(star);
            }
          }, 2000);
        }
      }
      // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ CSS —á–µ—Ä–µ–∑ JavaScript
      const style = document.createElement("style");
      style.textContent = `
        @keyframes shinePulse {
          0% { transform: scale(0); opacity: 0; }
          50% { transform: scale(1.5); opacity: 1; }
          100% { transform: scale(0); opacity: 0; }
        }
        @keyframes sparklePulse {
          0% { transform: scale(0); opacity: 0; }
          30% { transform: scale(1.8); opacity: 1; }
          70% { transform: scale(1.2); opacity: 1; }
          100% { transform: scale(0); opacity: 0; }
        }
        @keyframes starPulse {
          0% { transform: scale(0) rotate(0deg); opacity: 0; }
          40% { transform: scale(1.5) rotate(180deg); opacity: 1; }
          80% { transform: scale(1.1) rotate(360deg); opacity: 1; }
          100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
      // === –û–ë–ù–û–í–õ–ï–ù–ò–ï –ú–ê–ì–ê–ó–ò–ù–ê ===
      function showShop() {
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("shopScreen").style.display = "block";
        switchTab("abilities");
        updateDailyBonusButton();
      }
      function showPurchaseAnimation(amount) {
        const coin = document.createElement("div");
        coin.className = "purchase-animation";
        coin.textContent = "-" + amount;
        document.body.appendChild(coin);
        setTimeout(() => {
          if (coin.parentNode) coin.parentNode.removeChild(coin);
        }, 1500);
      }
      function showNotification(message) {
        const notif = document.getElementById("notification");
        notif.textContent = message;
        notif.classList.add("show");
        setTimeout(() => {
          notif.classList.remove("show");
        }, 3000);
      }
      function saveProgress() {
        localStorage.setItem("unlockedLevels", unlockedLevels);
        localStorage.setItem(
          "completedLevels",
          JSON.stringify(completedLevels)
        );
        localStorage.setItem("unlockedEpisodes", unlockedEpisodes);
        localStorage.setItem("upgrades", JSON.stringify(upgrades));
        localStorage.setItem("totalCoins", totalCoins);
        localStorage.setItem("lastAttemptedLevel", lastAttemptedLevel);
        localStorage.setItem("rankLevel", rankLevel);
        localStorage.setItem("currentExp", currentExp);
        localStorage.setItem("resetCount", resetCount);
      }
      function loadProgress() {
        unlockedLevels = parseInt(localStorage.getItem("unlockedLevels")) || 1;
        const saved = localStorage.getItem("completedLevels");
        completedLevels = saved ? JSON.parse(saved) : [];
        unlockedEpisodes =
          parseInt(localStorage.getItem("unlockedEpisodes")) || 1;
        const savedUpgrades = localStorage.getItem("upgrades");
        if (savedUpgrades) {
          upgrades = JSON.parse(savedUpgrades);
          // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è
          Object.keys(upgradeConfig).forEach((type) => {
            if (upgrades[type] > 0) {
              applyUpgradeEffect(type);
            }
          });
        }
        totalCoins = parseInt(localStorage.getItem("totalCoins")) || 0;
        lastAttemptedLevel =
          parseInt(localStorage.getItem("lastAttemptedLevel")) || 1;
        rankLevel = parseInt(localStorage.getItem("rankLevel")) || 1;
        currentExp = parseInt(localStorage.getItem("currentExp")) || 0;
        requiredExp = calculateRequiredExp(rankLevel);
        resetCount = parseInt(localStorage.getItem("resetCount")) || 0;
        const totalCoinsElement = document.getElementById("totalCoins");
        if (totalCoinsElement) {
          totalCoinsElement.textContent = totalCoins;
        }
        if (document.getElementById("rankLevel")) {
          updateExpBar();
        }
      }
      // === –§–£–ù–ö–¶–ò–ò –°–ë–†–û–°–ê –ü–†–û–ì–†–ï–°–°–ê ===
      function showResetScreen() {
        if (!canResetProgress()) {
          showNotification("–°–±—Ä–æ—Å –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ 10, 20, 30... —Ä–∞–Ω–≥–∞—Ö!");
          return;
        }
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("resetScreen").style.display = "block";
      }
      function cancelReset() {
        document.getElementById("resetScreen").style.display = "none";
        document.getElementById("startScreen").style.display = "block";
      }
      function confirmReset() {
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–±—Ä–æ—Å–æ–≤
        resetCount++;
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å—á–µ—Ç—á–∏–∫
        localStorage.setItem("resetCount", resetCount);
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫—Ä–æ–º–µ —Ä–∞–Ω–≥–∞
        totalCoins = 0;
        unlockedLevels = 1;
        completedLevels = [];
        unlockedEpisodes = 1;
        lastAttemptedLevel = 1;
        upgrades = {
          wave: 0,
          magnet: 0,
          health: 0,
          speed: 0,
        };
        // –†–∞–Ω–≥ –∏ –æ–ø—ã—Ç –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è
        // requiredExp —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–æ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        waveCooldown = baseWaveCooldown;
        magnetCooldown = baseMagnetCooldown;
        maxLives = 10;
        player.speed = 3;
        
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage, –∫—Ä–æ–º–µ —Ä–∞–Ω–≥–∞ –∏ —Å—á–µ—Ç—á–∏–∫–∞ —Å–±—Ä–æ—Å–æ–≤
        localStorage.removeItem("unlockedLevels");
        localStorage.removeItem("completedLevels");
        localStorage.removeItem("unlockedEpisodes");
        localStorage.removeItem("upgrades");
        localStorage.removeItem("totalCoins");
        localStorage.removeItem("lastAttemptedLevel");
        localStorage.removeItem("lastDailyBonusTime");
        // rankLevel, currentExp –∏ resetCount —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        document.getElementById("totalCoins").textContent = totalCoins;
        document.getElementById("resetScreen").style.display = "none";
        document.getElementById("startScreen").style.display = "block";
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–æ–∫ —Å–±—Ä–æ—Å–∞
        updateResetButton();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        showNotification(`üîÑ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω! –í—ã ${resetCount} —Ä–∞–∑(–∞) —Å–±—Ä–∞—Å—ã–≤–∞–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å.`);
      }
      // === –≠–ö–†–ê–ù –ò–°–¢–û–†–ò–ò ===
      function showGloryRoad() {
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("gloryRoad").style.display = "block";
        renderGloryRoad();
      }
      function renderGloryRoad() {
        const container1 = document.getElementById("episode1Levels");
        const container2 = document.getElementById("episode2Levels");
        container1.innerHTML = "";
        container2.innerHTML = "";
        for (let i = 1; i <= 5; i++) {
          const dot = document.createElement("div");
          dot.className = "level-dot";
          dot.textContent = i;
          if (completedLevels.includes(i)) {
            dot.classList.add("completed");
          } else if (i > unlockedLevels) {
            dot.classList.add("locked");
          } else {
            dot.classList.add("current");
          }
          if (i <= unlockedLevels) {
            dot.onclick = () => {
              if (
                confirm("–ù–∞—á–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å " + i + "? –í–∞—à–∏ –º–æ–Ω–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è.")
              ) {
                currentLevel = i;
                startGame();
              }
            };
          }
          container1.appendChild(dot);
        }
        for (let i = 6; i <= 10; i++) {
          const dot = document.createElement("div");
          dot.className = "level-dot";
          dot.textContent = i;
          const isUnlocked = completedLevels.includes(5);
          if (completedLevels.includes(i)) {
            dot.classList.add("completed");
          } else if (!isUnlocked) {
            dot.classList.add("locked");
            dot.textContent = "?";
          } else if (i > unlockedLevels) {
            dot.classList.add("locked");
          } else {
            dot.classList.add("current");
          }
          if (isUnlocked && i <= unlockedLevels) {
            dot.onclick = () => {
              if (
                confirm("–ù–∞—á–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å " + i + "? –í–∞—à–∏ –º–æ–Ω–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è.")
              ) {
                currentLevel = i;
                startGame();
              }
            };
          }
          container2.appendChild(dot);
        }
      }
      // === –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
      function showStartScreen() {
        document.getElementById("startScreen").style.display = "block";
        document.getElementById("difficultyScreen").style.display = "none";
        document.getElementById("gloryRoad").style.display = "none";
        document.getElementById("shopScreen").style.display = "none";
        document.getElementById("resetScreen").style.display = "none";
      }
      function showDifficultyScreen() {
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("difficultyScreen").style.display = "block";
      }
      function saveAndReturnToMain() {
        document.getElementById("difficultyScreen").style.display = "none";
        document.getElementById("startScreen").style.display = "block";
      }
      function showPauseScreen() {
        if (gameRunning) {
          document.getElementById("pauseScreen").style.display = "block";
          gamePaused = true;
        }
      }
      function hidePauseScreen() {
        document.getElementById("pauseScreen").style.display = "none";
        gamePaused = false;
      }
      function togglePause() {
        if (gameRunning && !gamePaused) {
          showPauseScreen();
        } else if (gameRunning && gamePaused) {
          hidePauseScreen();
        }
      }
      function resumeGame() {
        hidePauseScreen();
      }
      function quitToMainMenuFromScreen() {
        document.getElementById("levelComplete").style.display = "none";
        document.getElementById("gameOver").style.display = "none";
        document.getElementById("winScreen").style.display = "none";
        quitToMainMenu();
      }
      function quitToMainMenu() {
        if (gameLoop) {
          clearInterval(gameLoop);
          gameLoop = null;
        }
        gameRunning = false;
        gamePaused = false;
        document.getElementById("gameContainer").style.display = "none";
        document.getElementById("pauseScreen").style.display = "none";
        document.getElementById("startScreen").style.display = "block";
      }
      function setDifficulty(level) {
        difficulty = level;
        document
          .getElementById("easyBtn")
          .classList.toggle("active", level === "easy");
        document
          .getElementById("hardBtn")
          .classList.toggle("active", level === "hard");
      }
      function initGame() {
        canvas = document.getElementById("gameCanvas");
        const gameBoard = document.querySelector(".game-board");
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas —Å —É—á–µ—Ç–æ–º —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        canvas.width = gameBoard.clientWidth;
        canvas.height = gameBoard.clientHeight;
        ctx = canvas.getContext("2d");
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä–æ–∫–∞ –≤ —Ü–µ–Ω—Ç—Ä –∞—Ä–µ–Ω—ã
        player.x = canvas.width / 2 - player.size / 2;
        player.y = canvas.height / 2 - player.size / 2;
        trail = [];
        magnetLines = [];
        bullets = [];
        for (
          let i = 0;
          i < levelSettings[difficulty][currentLevel].coins;
          i++
        ) {
          spawnCoin();
        }
        for (
          let i = 0;
          i < levelSettings[difficulty][currentLevel].enemies;
          i++
        ) {
          spawnEnemy();
        }
        const levelConfig = levelSettings[difficulty][currentLevel];
        if (levelConfig.bigEnemies && currentLevel >= 3) {
          for (let i = 0; i < levelConfig.bigEnemies; i++) {
            spawnBigEnemy();
          }
        }
        if (levelConfig.shooters && currentLevel >= 7) {
          for (let i = 0; i < levelConfig.shooters; i++) {
            spawnShooter();
          }
        }
        document.addEventListener("keydown", onKeyDown);
        document.addEventListener("keyup", onKeyUp);
        gameLoop = setInterval(update, 1000 / 60);
      }
      function onKeyDown(e) {
        keys[e.key.toLowerCase()] = true;
        if (e.key === " " || e.key === "Spacebar") {
          e.preventDefault();
          activateWave();
        }
        if (e.key === "Shift") {
          e.preventDefault();
          activateMagnet();
        }
        if (e.key === "Escape") {
          e.preventDefault();
          togglePause();
        }
      }
      function onKeyUp(e) {
        keys[e.key.toLowerCase()] = false;
      }
      function spawnCoin() {
        let x, y;
        do {
          x = Math.random() * (canvas.width - 20);
          y = Math.random() * (canvas.height - 200) + 20;
        } while (
          getDistance(x + 7.5, y + 7.5, player.x + 15, player.y + 15) <
          MIN_SPAWN_DISTANCE
        );
        coins.push({
          x: x,
          y: y,
          size: 15,
          color: "#d69e2e",
        });
      }
      function spawnEnemy() {
        let attempts = 0;
        let maxAttempts = 50;
        let x, y;
        do {
          let side = Math.floor(Math.random() * 4);
          switch (side) {
            case 0:
              x = Math.random() * canvas.width;
              y = -30;
              break;
            case 1:
              x = canvas.width + 30;
              y = Math.random() * canvas.height;
              break;
            case 2:
              x = Math.random() * canvas.width;
              y = canvas.height + 30;
              break;
            case 3:
              x = -30;
              y = Math.random() * canvas.height;
              break;
          }
          attempts++;
        } while (
          attempts < maxAttempts &&
          getDistance(x + 11, y + 11, player.x + 15, player.y + 15) <
            MIN_SPAWN_DISTANCE
        );
        if (attempts >= maxAttempts) {
          let corner = Math.floor(Math.random() * 4);
          switch (corner) {
            case 0:
              x = 0;
              y = 0;
              break;
            case 1:
              x = canvas.width;
              y = 0;
              break;
            case 2:
              x = 0;
              y = canvas.height;
              break;
            case 3:
              x = canvas.width;
              y = canvas.height;
              break;
          }
        }
        enemies.push({
          x: x,
          y: y,
          size: 22,
          speed:
            0.5 +
            Math.random() * levelSettings[difficulty][currentLevel].enemySpeed,
          color: "#e53e3e",
          type: "normal",
          trail: [],
        });
      }
      function spawnBigEnemy() {
        if (currentLevel < 3) return;
        let attempts = 0;
        let maxAttempts = 50;
        let x, y;
        do {
          let side = Math.floor(Math.random() * 4);
          switch (side) {
            case 0:
              x = Math.random() * canvas.width;
              y = -45;
              break;
            case 1:
              x = canvas.width + 45;
              y = Math.random() * canvas.height;
              break;
            case 2:
              x = Math.random() * canvas.width;
              y = canvas.height + 45;
              break;
            case 3:
              x = -45;
              y = Math.random() * canvas.height;
              break;
          }
          attempts++;
        } while (
          attempts < maxAttempts &&
          getDistance(x + 18.5, y + 18.5, player.x + 15, player.y + 15) <
            MIN_SPAWN_DISTANCE
        );
        if (attempts >= maxAttempts) {
          let corner = Math.floor(Math.random() * 4);
          switch (corner) {
            case 0:
              x = 0;
              y = 0;
              break;
            case 1:
              x = canvas.width;
              y = 0;
              break;
            case 2:
              x = 0;
              y = canvas.height;
              break;
            case 3:
              x = canvas.width;
              y = canvas.height;
              break;
          }
        }
        const levelConfig = levelSettings[difficulty][currentLevel];
        const speedMultiplier = 0.6 + currentLevel * 0.1;
        enemies.push({
          x: x,
          y: y,
          size: 37,
          speed:
            0.3 + Math.random() * (levelConfig.enemySpeed * speedMultiplier),
          color: "#9b2c2c",
          type: "big",
          trail: [],
        });
      }
      function spawnShooter() {
        let attempts = 0;
        let maxAttempts = 50;
        let x, y;
        do {
          let side = Math.floor(Math.random() * 4);
          switch (side) {
            case 0:
              x = Math.random() * canvas.width;
              y = -40;
              break;
            case 1:
              x = canvas.width + 40;
              y = Math.random() * canvas.height;
              break;
            case 2:
              x = Math.random() * canvas.width;
              y = canvas.height + 40;
              break;
            case 3:
              x = -40;
              y = Math.random() * canvas.height;
              break;
          }
          attempts++;
        } while (
          attempts < maxAttempts &&
          getDistance(x + 14, y + 14, player.x + 15, player.y + 15) <
            MIN_SPAWN_DISTANCE
        );
        if (attempts >= maxAttempts) {
          let corner = Math.floor(Math.random() * 4);
          switch (corner) {
            case 0:
              x = 0;
              y = 0;
              break;
            case 1:
              x = canvas.width;
              y = 0;
              break;
            case 2:
              x = 0;
              y = canvas.height;
              break;
            case 3:
              x = canvas.width;
              y = canvas.height;
              break;
          }
        }
        enemies.push({
          x: x,
          y: y,
          size: 28,
          speed: 0.4,
          color: "#3182ce",
          type: "shooter",
          lastShot: 0,
          shotCooldown: 2000,
          trail: [],
        });
      }
      function getDistance(x1, y1, x2, y2) {
        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
      }
      function activateWave() {
        const now = Date.now();
        if (now - lastWaveTime >= waveCooldown) {
          lastWaveTime = now;
          try {
            waveAudio.currentTime = 0;
            waveAudio
              .play()
              .catch((e) =>
                console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –≤–æ–ª–Ω—ã:", e)
              );
          } catch (e) {
            console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –≤–æ–ª–Ω—ã:", e);
          }
          createWaveEffect(
            player.x + player.size / 2,
            player.y + player.size / 2
          );
          for (let i = enemies.length - 1; i >= 0; i--) {
            let enemy = enemies[i];
            const enemyCenterX = enemy.x + enemy.size / 2;
            const enemyCenterY = enemy.y + enemy.size / 2;
            const playerCenterX = player.x + player.size / 2;
            const playerCenterY = player.y + player.size / 2;
            const distance = getDistance(
              playerCenterX,
              playerCenterY,
              enemyCenterX,
              enemyCenterY
            );
            if (distance <= waveRadius) {
              enemies.splice(i, 1);
              score += 2;
              document.getElementById("score").textContent = score;
              // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—ã—Ç –∑–∞ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–∞
              addExp(5);
              const levelConfig = levelSettings[difficulty][currentLevel];
              if (score >= levelConfig.winScore) {
                if (currentLevel < 10) {
                  completeLevel();
                  return;
                } else {
                  winGame();
                  return;
                }
              }
              if (enemy.type === "big") {
                spawnBigEnemy();
              } else if (enemy.type === "shooter") {
                spawnShooter();
              } else {
                spawnEnemy();
              }
            }
          }
        }
      }
      function activateMagnet() {
        const now = Date.now();
        if (now - lastMagnetTime >= magnetCooldown) {
          lastMagnetTime = now;
          isMagnetActive = true;
          try {
            magnetAudio.currentTime = 0;
            magnetAudio
              .play()
              .catch((e) =>
                console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –º–∞–≥–Ω–∏—Ç–∞:", e)
              );
          } catch (e) {
            console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –º–∞–≥–Ω–∏—Ç–∞:", e);
          }
          createMagnetEffect(
            player.x + player.size / 2,
            player.y + player.size / 2
          );
          for (let i = coins.length - 1; i >= 0; i--) {
            let coin = coins[i];
            const coinCenterX = coin.x + coin.size / 2;
            const coinCenterY = coin.y + coin.size / 2;
            const playerCenterX = player.x + player.size / 2;
            const playerCenterY = player.y + player.size / 2;
            const distance = getDistance(
              playerCenterX,
              playerCenterY,
              coinCenterX,
              coinCenterY
            );
            if (distance <= magnetRadius) {
              createMagnetLine(
                coinCenterX,
                coinCenterY,
                playerCenterX,
                playerCenterY
              );
            }
          }
          setTimeout(() => {
            isMagnetActive = false;
          }, 300);
        }
      }
      function createWaveEffect(x, y) {
        const waveDiv = document.createElement("div");
        waveDiv.className = "wave-effect";
        const canvasRect = canvas.getBoundingClientRect();
        const centerX = x + canvasRect.left + window.scrollX;
        const centerY = y + canvasRect.top + window.scrollY;
        waveDiv.style.left = `${centerX}px`;
        waveDiv.style.top = `${centerY}px`;
        document.body.appendChild(waveDiv);
        setTimeout(() => {
          if (waveDiv.parentNode) waveDiv.parentNode.removeChild(waveDiv);
        }, 500);
      }
      function createMagnetEffect(x, y) {
        const magnetDiv = document.createElement("div");
        magnetDiv.className = "magnet-effect";
        const canvasRect = canvas.getBoundingClientRect();
        const centerX = x + canvasRect.left + window.scrollX;
        const centerY = y + canvasRect.top + window.scrollY;
        magnetDiv.style.left = `${centerX}px`;
        magnetDiv.style.top = `${centerY}px`;
        document.body.appendChild(magnetDiv);
        setTimeout(() => {
          if (magnetDiv.parentNode) magnetDiv.parentNode.removeChild(magnetDiv);
        }, 300);
      }
      function createMagnetLine(startX, startY, endX, endY) {
        const line = document.createElement("div");
        line.className = "magnet-line";
        const canvasRect = canvas.getBoundingClientRect();
        const absStartX = startX + canvasRect.left + window.scrollX;
        const absStartY = startY + canvasRect.top + window.scrollY;
        const absEndX = endX + canvasRect.left + window.scrollX;
        const absEndY = endY + canvasRect.top + window.scrollY;
        const length = Math.sqrt(
          Math.pow(absEndX - absStartX, 2) + Math.pow(absEndY - absStartY, 2)
        );
        const angle =
          (Math.atan2(absEndY - absStartY, absEndX - absStartX) * 180) /
          Math.PI;
        line.style.width = `${length}px`;
        line.style.left = `${absStartX}px`;
        line.style.top = `${absStartY}px`;
        line.style.transform = `rotate(${angle}deg)`;
        document.body.appendChild(line);
        setTimeout(() => {
          if (line.parentNode) line.parentNode.removeChild(line);
        }, 300);
      }
      function update() {
        if (gamePaused || !gameRunning) return;
        const oldX = player.x;
        const oldY = player.y;
        if (keys["a"] && player.x > 0) player.x -= player.speed;
        if (keys["d"] && player.x < canvas.width - player.size)
          player.x += player.speed;
        if (keys["w"] && player.y > 0) player.y -= player.speed;
        if (keys["s"] && player.y < canvas.height - player.size)
          player.y += player.speed;
        if (player.x !== oldX || player.y !== oldY) {
          trail.unshift({
            x: player.x + player.size / 2,
            y: player.y + player.size / 2,
          });
          if (trail.length > maxTrailLength) trail.pop();
        }
        enemies.forEach((enemy) => {
          const oldX = enemy.x;
          const oldY = enemy.y;
          if (enemy.type === "shooter") {
            let dx = player.x - enemy.x;
            let dy = player.y - enemy.y;
            let distance = Math.sqrt(dx * dx + dy * dy);
            if (distance > 0) {
              enemy.x += (dx / distance) * enemy.speed;
              enemy.y += (dy / distance) * enemy.speed;
            }
            const now = Date.now();
            if (now - enemy.lastShot >= enemy.shotCooldown) {
              enemy.lastShot = now;
              const angle = Math.atan2(dy, dx);
              bullets.push({
                x: enemy.x + enemy.size / 2,
                y: enemy.y + enemy.size / 2,
                vx: Math.cos(angle) * 5,
                vy: Math.sin(angle) * 5,
                size: 8,
                color: "#e53e3e",
              });
              try {
                waveAudio.currentTime = 0;
                waveAudio
                  .play()
                  .catch((e) =>
                    console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –≤—ã—Å—Ç—Ä–µ–ª–∞:", e)
                  );
              } catch (e) {
                console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –≤—ã—Å—Ç—Ä–µ–ª–∞:", e);
              }
            }
          } else {
            let dx = player.x - enemy.x;
            let dy = player.y - enemy.y;
            let distance = Math.sqrt(dx * dx + dy * dy);
            if (distance > 0) {
              enemy.x += (dx / distance) * enemy.speed;
              enemy.y += (dy / distance) * enemy.speed;
            }
          }
          if (enemy.x !== oldX || enemy.y !== oldY) {
            enemy.trail.unshift({
              x: enemy.x + enemy.size / 2,
              y: enemy.y + enemy.size / 2,
            });
            if (enemy.trail.length > maxTrailLength) {
              enemy.trail.pop();
            }
          }
        });
        for (let i = bullets.length - 1; i >= 0; i--) {
          const bullet = bullets[i];
          bullet.x += bullet.vx;
          bullet.y += bullet.vy;
          if (
            bullet.x < -10 ||
            bullet.x > canvas.width + 10 ||
            bullet.y < -10 ||
            bullet.y > canvas.height + 10
          ) {
            bullets.splice(i, 1);
            continue;
          }
          if (checkCollision(bullet, player)) {
            bullets.splice(i, 1);
            lives--;
            document.getElementById("lives").textContent = lives;
            try {
              hitAudio.currentTime = 0;
              hitAudio
                .play()
                .catch((e) =>
                  console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è:", e)
                );
            } catch (e) {
              console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è:", e);
            }
            if (lives <= 0) {
              endGame(false);
            }
          }
        }
        if (isMagnetActive) {
          for (let i = coins.length - 1; i >= 0; i--) {
            let coin = coins[i];
            const coinCenterX = coin.x + coin.size / 2;
            const coinCenterY = coin.y + coin.size / 2;
            const playerCenterX = player.x + player.size / 2;
            const playerCenterY = player.y + player.size / 2;
            const distance = getDistance(
              playerCenterX,
              playerCenterY,
              coinCenterX,
              coinCenterY
            );
            if (distance <= magnetRadius) {
              let dx = playerCenterX - coinCenterX;
              let dy = playerCenterY - coinCenterY;
              let length = Math.sqrt(dx * dx + dy * dy);
              if (length > 0) {
                dx /= length;
                dy /= length;
              }
              coin.x += dx * magnetStrength * 10;
              coin.y += dy * magnetStrength * 10;
            }
          }
        }
        for (let i = coins.length - 1; i >= 0; i--) {
          let coin = coins[i];
          if (checkCollision(player, coin)) {
            coins.splice(i, 1);
            score++;
            document.getElementById("score").textContent = score;
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—ã—Ç –∑–∞ —Å–±–æ—Ä –º–æ–Ω–µ—Ç–∫–∏ (1 EXP –∑–∞ –º–æ–Ω–µ—Ç–∫—É)
            addExp(1);
            try {
              coinAudio.currentTime = 0;
              coinAudio
                .play()
                .catch((e) =>
                  console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –º–æ–Ω–µ—Ç—ã:", e)
                );
            } catch (e) {
              console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –º–æ–Ω–µ—Ç—ã:", e);
            }
            const levelConfig = levelSettings[difficulty][currentLevel];
            if (score >= levelConfig.winScore) {
              if (currentLevel < 10) {
                completeLevel();
              } else {
                winGame();
              }
            } else {
              spawnCoin();
            }
          }
        }
        for (let i = enemies.length - 1; i >= 0; i--) {
          let enemy = enemies[i];
          if (enemy.type !== "shooter" && checkCollision(player, enemy)) {
            enemies.splice(i, 1);
            lives--;
            document.getElementById("lives").textContent = lives;
            try {
              hitAudio.currentTime = 0;
              hitAudio
                .play()
                .catch((e) =>
                  console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ —É–¥–∞—Ä–∞:", e)
                );
            } catch (e) {
              console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ —É–¥–∞—Ä–∞:", e);
            }
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—ã—Ç –∑–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –≤—Ä–∞–≥–æ–º
            addExp(3);
            if (enemy.type === "big") {
              spawnBigEnemy();
            } else if (enemy.type === "shooter") {
              spawnShooter();
            } else {
              spawnEnemy();
            }
            if (lives <= 0) {
              endGame(false);
            }
          }
        }
        if (Math.random() < 0.015) {
          const levelConfig = levelSettings[difficulty][currentLevel];
          if (
            enemies.length <
            levelConfig.enemies +
              (levelConfig.bigEnemies || 0) +
              (levelConfig.shooters || 0) +
              5
          ) {
            if (
              currentLevel >= 3 &&
              Math.random() < (levelConfig.bigEnemyChance || 0)
            ) {
              spawnBigEnemy();
            } else {
              spawnEnemy();
            }
          }
        }
        updateWaveCooldown();
        updateMagnetCooldown();
        render();
      }
      function updateWaveCooldown() {
        const now = Date.now();
        const timeLeft = waveCooldown - (now - lastWaveTime);
        const cooldownElement = document.getElementById("waveCooldown");
        if (timeLeft > 0) {
          const secondsLeft = Math.ceil(timeLeft / 1000);
          cooldownElement.textContent = secondsLeft + "—Å";
          cooldownElement.style.color = "#e53e3e";
        } else {
          cooldownElement.textContent = "–ì–æ—Ç–æ–≤–∞";
          cooldownElement.style.color = "#48bb78";
        }
      }
      function updateMagnetCooldown() {
        const now = Date.now();
        const timeLeft = magnetCooldown - (now - lastMagnetTime);
        const cooldownElement = document.getElementById("magnetCooldown");
        if (timeLeft > 0) {
          const secondsLeft = Math.ceil(timeLeft / 1000);
          cooldownElement.textContent = secondsLeft + "—Å";
          cooldownElement.style.color = "#e53e3e";
        } else {
          cooldownElement.textContent = "–ì–æ—Ç–æ–≤";
          cooldownElement.style.color = "#48bb78";
        }
      }
      function checkCollision(obj1, obj2) {
        return (
          obj1.x < obj2.x + obj2.size &&
          obj1.x + obj1.size > obj2.x &&
          obj1.y < obj2.y + obj2.size &&
          obj1.y + obj1.size > obj2.y
        );
      }
      function render() {
        ctx.fillStyle = "#1a202c";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < trail.length; i++) {
          const point = trail[i];
          const alpha = 1 - i / trail.length;
          const size = 6 * (1 - i / trail.length);
          ctx.fillStyle = `rgba(72, 187, 120, ${alpha * 0.7})`;
          ctx.fillRect(point.x - size / 2, point.y - size / 2, size, size);
        }
        enemies.forEach((enemy) => {
          for (let i = 0; i < enemy.trail.length; i++) {
            const point = enemy.trail[i];
            const alpha = 1 - i / enemy.trail.length;
            const size = 5 * (1 - i / enemy.trail.length);
            let color;
            if (enemy.type === "big") {
              color = "#9b2c2c";
            } else if (enemy.type === "shooter") {
              color = "#3182ce";
            } else {
              color = "#e53e3e";
            }
            ctx.fillStyle = `rgba(${hexToRgb(color)}, ${alpha * 0.6})`;
            ctx.fillRect(point.x - size / 2, point.y - size / 2, size, size);
          }
        });
        ctx.fillStyle = "#48bb78";
        ctx.fillRect(player.x, player.y, player.size, player.size);
        coins.forEach((coin) => {
          ctx.fillStyle = "#d69e2e";
          ctx.fillRect(coin.x, coin.y, coin.size, coin.size);
        });
        enemies.forEach((enemy) => {
          ctx.fillStyle = enemy.color;
          ctx.fillRect(enemy.x, enemy.y, enemy.size, enemy.size);
          if (enemy.type === "big") {
            ctx.fillStyle = "#fed7d7";
            ctx.fillRect(
              enemy.x + 7,
              enemy.y + 7,
              enemy.size - 14,
              enemy.size - 14
            );
          }
        });
        bullets.forEach((bullet) => {
          ctx.fillStyle = bullet.color;
          ctx.fillRect(
            bullet.x - bullet.size / 2,
            bullet.y - bullet.size / 2,
            bullet.size,
            bullet.size
          );
        });
      }
      function endGame(win) {
        gameRunning = false;
        gamePaused = false;
        clearInterval(gameLoop);
        document.removeEventListener("keydown", onKeyDown);
        document.removeEventListener("keyup", onKeyUp);
        totalCoins += score;
        document.getElementById("totalCoins").textContent = totalCoins;
        localStorage.setItem("totalCoins", totalCoins);
        if (win || score >= levelSettings[difficulty][currentLevel].winScore) {
          if (!completedLevels.includes(currentLevel)) {
            completedLevels.push(currentLevel);
            if (unlockedLevels < 10) {
              unlockedLevels++;
            }
            if (currentLevel === 5) {
              showNotification("üîì –û—Ç–∫—Ä—ã—Ç –≠–ø–∏–∑–æ–¥ 2: –¢—ë–º–Ω—ã–µ –≥–ª—É–±–∏–Ω—ã!");
            }
            lastAttemptedLevel = currentLevel + 1;
          }
        } else {
          lastAttemptedLevel = currentLevel;
        }
        saveProgress();
        document.getElementById(
          "finalScore"
        ).textContent = `–°—ã–≥—Ä–∞–Ω–æ: –£—Ä–æ–≤–µ–Ω—å ${currentLevel}. –°–æ–±—Ä–∞–Ω–æ: ${score} –º–æ–Ω–µ—Ç. –í—Å–µ–≥–æ: ${totalCoins}`;
        document.getElementById("gameOver").style.display = "block";
      }
      function completeLevel() {
        gameRunning = false;
        gamePaused = false;
        clearInterval(gameLoop);
        document.removeEventListener("keydown", onKeyDown);
        document.removeEventListener("keyup", onKeyUp);
        totalCoins += score;
        document.getElementById("totalCoins").textContent = totalCoins;
        localStorage.setItem("totalCoins", totalCoins);
        if (!completedLevels.includes(currentLevel)) {
          completedLevels.push(currentLevel);
          if (unlockedLevels < 10) {
            unlockedLevels++;
          }
          if (currentLevel === 5) {
            showNotification("üîì –û—Ç–∫—Ä—ã—Ç –≠–ø–∏–∑–æ–¥ 2: –¢—ë–º–Ω—ã–µ –≥–ª—É–±–∏–Ω—ã!");
          }
          lastAttemptedLevel = currentLevel + 1;
        }
        saveProgress();
        document.getElementById(
          "levelCompleteText"
        ).textContent = `–£—Ä–æ–≤–µ–Ω—å ${currentLevel} –ø—Ä–æ–π–¥–µ–Ω! –°–æ–±—Ä–∞–Ω–æ: ${score} –º–æ–Ω–µ—Ç. –í—Å–µ–≥–æ: ${totalCoins}`;
        document.getElementById("levelComplete").style.display = "block";
      }
      function nextLevel() {
        currentLevel = Math.min(currentLevel + 1, 10);
        document.getElementById("level").textContent = currentLevel;
        document.getElementById("levelComplete").style.display = "none";
        coins = [];
        enemies = [];
        bullets = [];
        keys = {};
        gameRunning = true;
        gamePaused = false;
        initGame();
      }
      function winGame() {
        endGame(true);
      }
      function startGame() {
        if (lastAttemptedLevel >= 1 && lastAttemptedLevel <= 10) {
          currentLevel = lastAttemptedLevel;
        } else {
          currentLevel = 1;
        }
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("gameContainer").style.display = "block";
        document.getElementById("gloryRoad").style.display = "none";
        document.getElementById("shopScreen").style.display = "none";
        document.getElementById("resetScreen").style.display = "none";
        player = { x: 400, y: 500, size: 30, speed: 3, color: "#48bb78" };
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è
        Object.keys(upgradeConfig).forEach((type) => {
          if (upgrades[type] > 0) {
            applyUpgradeEffect(type);
          }
        });
        coins = [];
        enemies = [];
        bullets = [];
        score = 0;
        lives = maxLives;
        gamePaused = false;
        lastWaveTime = 0;
        lastMagnetTime = 0;
        isMagnetActive = false;
        keys = {};
        document.getElementById("score").textContent = score;
        document.getElementById("lives").textContent = lives;
        document.getElementById("level").textContent = currentLevel;
        document.getElementById("waveCooldown").textContent = "–ì–æ—Ç–æ–≤–∞";
        document.getElementById("waveCooldown").style.color = "#48bb78";
        document.getElementById("magnetCooldown").textContent = "–ì–æ—Ç–æ–≤";
        document.getElementById("magnetCooldown").style.color = "#48bb78";
        gameRunning = true;
        initGame();
      }
      function restartGame() {
        document.getElementById("gameOver").style.display = "none";
        document.getElementById("winScreen").style.display = "none";
        startGame();
      }
      window.addEventListener("load", function () {
        loadProgress();
        updateDailyBonusButton();
        updateResetButton();
      });
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
      window.addEventListener("resize", function () {
        if (gameRunning && canvas) {
          const gameBoard = document.querySelector(".game-board");
          canvas.width = gameBoard.clientWidth;
          canvas.height = gameBoard.clientHeight;
          // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
          player.x = canvas.width / 2 - player.size / 2;
          player.y = canvas.height / 2 - player.size / 2;
        }
      });
    </script>
  </body>
</html>